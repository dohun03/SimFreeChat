services:
  my-chat-server:
    build: 
      context: .
      target: development
    deploy:
      replicas: 2
    environment:
      - NODE_ENV=development
      - DB_HOST=host.docker.internal
      - REDIS_HOST=redis-service
    volumes:
      - .:/usr/src/app
      - /usr/src/app/node_modules
    command: npm run start:dev
    extra_hosts:
      - "host.docker.internal:host-gateway"

  redis-service:
    container_name: redis-cache-dev
    ports:
      - "6379:6379"

  nginx-proxy:
    container_name: nginx-web-dev
    ports:
      - "80:80"
    volumes:
      - ./public:/usr/share/nginx/html:ro
      - ./uploads:/var/www/uploads:ro